{
    "Dockerfile": "FROM php:8.1-apache\nCOPY src/ /var/www/html/\nCOPY git/.git /var/www/html/.git/\nCOPY sqlite/ /var/www/sqlite/\nCOPY flag.txt /flag.txt\n",
    "flag.txt": "tamuctf{my_f4v0rit4_7yp3_0f_w3b_ch4113ng3}\n",
    "git.tar.gz": "[Binary file or unsupported type: gz]",
    "Makefile": "start:\n\ttar -xvf git.tar.gz\n\tdocker build -t blackbox .\n\tdocker run -d --restart=always --name tamuctf-blackbox -p 8000:80 blackbox\n\trm -rf git\nstop:\n\tdocker container rm -f tamuctf-blackbox\n",
    "README.md": "# Blackbox\n\nAuthor: `Mr. Blade`\n\n## Description\n\nI took a survey to find our dev's least favorite type of web challenge. The results of my survey showed that blackbox web is by far the most frustrating type of web challenge. Let's see what your opinion of it it.\n\n## Solution\n\nThe challenge is much more difficult without the password being in the comments ;)\n\n![](https://cdn.betterttv.net/emote/5d76c43abd340415e9f32fb1/3x)\n\n\\> be me<br>\n\\> robots.txt shows .git exists<br>\n\\> .git is forbidden :sadge:<br>\n\\> codebreakers task b2 enters my mind<br>\n\\> use git-dumper<br>\n\\> lmao the files exists (SOURCE!!!)<br>\n\\> read `util.py` and find `SECRET_KEY` is defined but not shown (h m m)<br>\n\\> index.php shows `require ./config.php`... \u0d9e\u0d9e\u0d9e<br>\n\\> can't traverse to config.php, use filter wrapper to pull the file in a different way (http://localhost:8000/?page=php://filter/convert.base64-encode/resource=config)<br>\n\\> decode file, get `SECRET_KEY`<br>\n\\> *back to website now*<br>\n\\> go to login page, grab `auth_token` cookie and decode to understand the format<br>\n\\> realize there's a `user_key` field... pain<br>\n\\> *back to .git directory*<br>\n\\> oh wow, a sqlite database<br>\n\\> grab the only entry in `users` and get the `user_key`<br>\n\\> reconstruct admin cookie<br>\n\\> replace the entries in the guest cookie with the admin values (`{\"username\":\"admin\",\"user_key\":\"26ceb685f46e6d22\",\"admin\":true}`) and base64 encode it<br>\n\\> we can also recreate the checksum with the `SECRET_KEY` according to `util.py`<br>\n\\> change `auth_token` on the website to the values we just created<br>\n\\> flag is so free: `tamuctf{my_f4v0rit4_7yp3_0f_w3b_ch4113ng3}`<br>\n\ud83c\udd71\ufe0f\n",
    "sqlite\\site-data.db": "[Binary file or unsupported type: db]",
    "src\\config.php": "<?php\nconst APP_NAME = 'Blackbox';\nconst INCLUDE_DIR = './templates/';\nconst DB_FILE = '../sqlite/site-data.db';\nconst SECRET_KEY = 'JYOFGX6w5ylmYXyHuMM2Rm7neHXLrBd2V0f5No3NlP8';\n?>\n",
    "src\\index.php": "<?php\n$resource = 'home';\n\nrequire './config.php';\nrequire './util.php';\n\nset_include_path(INCLUDE_DIR);\n\nif(isset($_GET['page'])) {\n  $resource = $_GET['page'];\n  include($_GET['page'] . '.php');\n} else {\n  include('home.php');\n}\n?>\n",
    "src\\robots.txt": "User-agent: *\nDisallow: /.git/\n",
    "src\\util.php": "<?php\nfunction db_login(string $username, string $password) {\n  $db = new SQLite3(DB_FILE);\n  $statement = $db->prepare('SELECT key FROM users WHERE username=:uname AND password=:passwd;');\n\n  $statement->bindValue(':uname', $username);\n  $statement->bindValue(':passwd', $password);\n\n  return $statement->execute();\n}\n\nfunction try_auth(string $username, string $password) {\n  $hash_password = hash('sha256', $password);\n  return db_login($username, $hash_password)->fetchArray();\n}\n\nfunction generate_guest_token() {\n  $data = array('username'=>'guest', 'user_key'=>bin2hex(random_bytes(8)), 'admin'=>false);\n  return generate_token($data);\n}\n\nfunction generate_admin_token(string $username, string $user_key) {\n  $data = array('username'=>$username, 'user_key'=>$user_key, 'admin'=>true);\n  return generate_token($data);\n}\n\nfunction generate_token(array $data) {\n  $b64json = base64_encode(json_encode($data));\n  $hmac = hash('md5', SECRET_KEY . $b64json);\n\n  return $b64json . '.' . $hmac;\n}\n\nfunction verify_token(string $token) { \n  $token_data = explode('.', $token);\n  if(hash('md5', SECRET_KEY . $token_data[0]) == $token_data[1]) {\n    return true;\n  }\n  return false;\n}\n\nfunction is_admin(string $token) {\n  if(verify_token($token)) {\n    $db = new SQLite3(DB_FILE);\n\n    $data = json_decode(base64_decode(explode('.', $token)[0]), TRUE);\n    $username = $data['username'];\n    $user_key = $data['user_key'];\n    $admin = $data['admin'];\n\n    $statement = $db->prepare('SELECT * FROM users WHERE username=:uname AND key=:ukey;');\n    $statement->bindValue(':uname', $username);\n    $statement->bindValue(':ukey', $user_key);\n    $result = $statement->execute();\n\n    if($result != false && $result->fetchArray() != false && $admin == true) {\n      return true;\n    }\n    return false;\n  }\n}\n?>\n",
    "src\\static\\admin.css": "",
    "src\\static\\header.css": "html {\n  background-color: #202A44;\n  color: white;\n}\n\nbody {\n  margin: 0;\n}\n\nh1 {\n  color: white;\n}\n\n.site-header {\n  position: sticky;\n  top: 0;\n  background: rgb(21,32,43);\n  z-index: 1200;\n  height: 60px;\n  padding: 0;\n}\n\n.header-content {\n  max-width: 1000px;\n  margin-right: auto;\n  margin-left: auto;\n  padding-left: 30px;\n  padding-right: 30px;\n}\n\n.site-title, .site-title:visited {\n  text-decoration: none;\n  color: white;\n  font-size: 26px;\n  font-weight: 300;\n  line-height: 54px;\n  letter-spacing: -1px;\n  margin-bottom: 0;\n  float: left;\n}\n\n.page-link {\n  text-decoration: none;\n  color: white;\n  font-size: 26px;\n  font-weight: 300;\n  line-height: 54px;\n  letter-spacing: -1px;\n  margin-bottom: 0;\n  float: right;\n}\n\n",
    "src\\static\\home.css": ".site-content {\n  content: \" \";\n  margin-top: 100px;\n  height: 75px;\n  display: block;\n  font-size: 24px;\n}\n",
    "src\\static\\login.css": ".login {\n  height: 200px;\n  width: 400px;\n  position: absolute;\n  transform: translate(-50%, -50%);\n  top: 50%;\n  left: 50%;\n  box-shadow: 0px 0px 50px #000;\n  border-radius: 10px;\n}\n\n.username {\n  height: 30px;\n  padding-bottom: 2px;\n  padding-left: 4px;\n  margin-top: 50px;\n  margin-bottom: 7px;\n  margin-right: 100px;\n  margin-left: 112px;\n  border-radius: 7px;\n  border: none;\n  box-shadow: 0px 0px 10px rgb(0, 0, 0);\n}\n\n.password {\n  height: 30px;\n  padding-bottom: 2px;\n  padding-left: 4px;\n  margin-bottom: 7px;\n  margin-right: 100px;\n  margin-left: 112px;\n  border-radius: 7px;\n  border: none;\n  box-shadow: 0px 0px 10px rgb(0, 0, 0);\n}\n\n.submit {\n  height: 30px;\n  margin-bottom: 25px;\n  border-radius: 7px;\n  border: none;\n  color: black;\n  background-color: #fff;\n  box-shadow: 0px 0px 2px white;\n  margin-left: 12px;\n}\n",
    "src\\templates\\admin.php": "<?php\nif(!isset($_COOKIE['auth_token']) || !is_admin($_COOKIE['auth_token'])) {\n  header('Location: ?page=login');\n  die();\n}\n?>\n\n<?php include(INCLUDE_DIR . 'header.php'); ?>\n<center>\n  <h1><?php include('/flag.txt'); ?></h1>\n</center>\n<?php include(INCLUDE_DIR . 'footer.php'); ?>\n",
    "src\\templates\\footer.php": "</body>\n</html>\n",
    "src\\templates\\header.php": "<!DOCTYPE html>\n<html>\n<head>\n  <link rel=\"stylesheet\" href=\"static/header.css\">\n  <link rel=\"stylesheet\" href=\"static/<?php echo $resource; ?>.css\">\n  <title><?php echo APP_NAME; ?></title>\n</head>\n<body>\n  <header>\n    <div class=\"site-header\">\n      <div class=\"header-content\">\n        <a class=\"site-title\" rel=\"author\" href=\"?page=home\">Home</a>\n        <nav class=\"site-nav\">\n        <a class=\"page-link\" href=\"?page=login\">\n<?php\nif(isset($_COOKIE['auth_token']) && is_admin($_COOKIE['auth_token'])) {\n  echo \"Admin\";\n} else {\n  echo \"Login\";\n}\n?>\n        </a>\n        </nav>\n      </div>\n    </div>\n  </header>\n",
    "src\\templates\\home.php": "<?php include(INCLUDE_DIR . 'header.php'); ?>\n<?php include(INCLUDE_DIR . 'footer.php'); ?>\n",
    "src\\templates\\login.php": "<?php\nif(!isset($_COOKIE['auth_token'])) {\n  setcookie('auth_token', generate_guest_token(), time() + (86400*30), '/');\n} else if(is_admin($_COOKIE['auth_token'])) {\n  header('Location: ?page=admin');\n  die();\n}\n\nif(isset($_POST['username']) && isset($_POST['password'])) {\n  $result = try_auth($_POST['username'], $_POST['password']); \n  if($result != false) {\n    setcookie('auth_token', generate_admin_token($_POST['username'], end($result)), time() + (86400*30), '/');\n    header('Location: ?page=admin');\n    die();\n  }\n}\n?>\n\n<?php include(INCLUDE_DIR . 'header.php'); ?>\n<main>\n  <div class=\"login\">\n    <center>\n      <form action=\"?page=login\", method=\"post\">\n        <input class=\"username\" placeholder=\"Username\" name=\"username\" id=\"username\"></input><br>\n        <input type=\"password\" class=\"password\" placeholder=\"Password\" name=\"password\" id=\"password\"></input><br>\n        <button class=\"submit\">Login</button>\n      </form>\n    </center>\n  </div>\n</main>\n<?php include(INCLUDE_DIR . 'footer.php'); ?>\n",
    "category": "web"
}